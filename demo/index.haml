!!! 5
%html
  %head
    %title Stypi Editor Demo
    %link{:rel => 'stylesheet', :type => 'text/css', :href => '../lib/reset.css'}
    %link{:rel => 'stylesheet', :type => 'text/css', :href => 'styles/style.css'}

%body
  #content-container
    .editor-wrapper
      #formatting-container.formatting-container
        .format-group
          .format-button.first<>
            .format.bold
          .format-button<>
            .format.italic
          .format-button<>
            .format.underline
          .format-button.last<>
            .format.strike
      #editor-container.editor-container
        .line<>
          %span<> Welcome to Stypi
        .line<>
          %b<> Bold
          %span<> &nbsp;
          %i<> Italic
          %span<> &nbsp;
          %s<> Strike
          %span<> &nbsp;
          %u<> Underline
        .line<>
          %span<> a
          %span<> b
          %span<> c
          %span<> d
          %span<> e
          %span<> f
          %span<> g
        .line<>
          %br<>
        .line<>
          %br<>
        .line<>
          %span<> Goodbye
        .line<>
          %br<>
    #output-container.output-container
      .selection
      %pre.editor

  %script{:type => 'text/javascript', :src => '../lib/jquery.js'}
  %script{:type => 'text/javascript', :src => '../lib/underscore.js'}
  %script{:type => 'text/javascript', :src => '../lib/eventemitter2.js'}
  %script{:type => 'text/javascript', :src => '../lib/rangy/rangy-core.js'}
  %script{:type => 'text/javascript', :src => '../lib/diff_match_patch.js'}
  %script{:type => 'text/javascript', :src => '../lib/jetsync.js'}
  %script{:type => 'text/javascript', :src => '../lib/jquery-clean.js'}
  %script{:type => 'text/javascript', :src => '../src/utils.js'}
  %script{:type => 'text/javascript', :src => '../src/range.js'}
  %script{:type => 'text/javascript', :src => '../src/position.js'}
  %script{:type => 'text/javascript', :src => '../src/leaf.js'}
  %script{:type => 'text/javascript', :src => '../src/line.js'}
  %script{:type => 'text/javascript', :src => '../src/document.js'}
  %script{:type => 'text/javascript', :src => '../src/editor.js'}
  %script{:type => 'text/javascript', :src => '../src/toolbar.js'}
  :javascript
    editor = new Tandem.Editor('editor-container');
    toolbar = new Tandem.Toolbar(editor)

    updateOutput = function() {
      $('#output-container .editor').text($.htmlClean(editor.iframeDoc.body.innerHTML, {
        allowedClasses: [['line']],
        format: true
      }));
    };

    editor.on(editor.events.API_TEXT_CHANGE, updateOutput)
          .on(editor.events.USER_TEXT_CHANGE, updateOutput);
    updateOutput()

    $('.bold').click(function() { toolbar.bold(); });
    $('.italic').click(function() { toolbar.italic(); });
    $('.strike').click(function() { toolbar.strike(); });
    $('.underline').click(function() { toolbar.underline(); });
